<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Console - Game Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .console-container {
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #1e293b 100%);
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .terminal-wrapper {
            background: #0f172a;
            border: 1px solid #334155;
        }
        .console-input {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid #475569;
        }
        .console-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .status-online { color: #10b981; }
        .status-offline { color: #ef4444; }
        .status-starting { color: #f59e0b; }
        .power-btn {
            transition: all 0.3s ease;
        }
        .power-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .chart-container {
            height: 120px;
        }
        .sidebar {
            background: rgba(15, 23, 42, 0.95);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-item {
            transition: all 0.2s ease;
        }
        .nav-item:hover {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
        }
        .nav-item.active {
            background: rgba(59, 130, 246, 0.2);
            border-left: 3px solid #3b82f6;
            color: #3b82f6;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Sidebar Navigation -->
    <div class="fixed left-0 top-0 h-full w-64 sidebar z-50">
        <div class="p-6">
            <div class="flex items-center space-x-3 mb-8">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold">Game Panel</h1>
                    <p class="text-sm text-gray-400">Server Management</p>
                </div>
            </div>

            <nav class="space-y-2">
                <a href="#" class="nav-item active flex items-center space-x-3 px-4 py-3 rounded-lg">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                    </svg>
                    <span>Console</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"/>
                    </svg>
                    <span>Files</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"/>
                        <path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <span>Databases</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                    <span>Backups</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>Schedules</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                    </svg>
                    <span>Users</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                    </svg>
                    <span>Settings</span>
                </a>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <div class="ml-64 console-container min-h-screen">
        <!-- Header -->
        <div class="border-b border-gray-700 bg-slate-800/50 backdrop-blur-sm sticky top-0 z-40">
            <div class="px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold">Minecraft Server #1</h1>
                        <div class="flex items-center space-x-4 mt-1">
                            <span class="status-online flex items-center space-x-1">
                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span class="text-sm">Online</span>
                            </span>
                            <span class="text-sm text-gray-400">play.example.com:25565</span>
                            <span class="text-sm text-gray-400">Uptime: 2h 34m</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <!-- Power Controls -->
                        <div class="flex items-center space-x-2">
                            <button class="power-btn bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm font-medium" onclick="sendPowerAction('start')">
                                <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                </svg>
                                Start
                            </button>
                            <button class="power-btn bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-lg text-sm font-medium" onclick="sendPowerAction('restart')">
                                <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                                </svg>
                                Restart
                            </button>
                            <button class="power-btn bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm font-medium" onclick="sendPowerAction('stop')">
                                <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"/>
                                </svg>
                                Stop
                            </button>
                            <button class="power-btn bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg text-sm font-medium" onclick="sendPowerAction('kill')">
                                <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                                Kill
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="p-6">
            <div class="grid grid-cols-2 lg:grid-cols-6 gap-4 mb-6">
                <div class="stat-card rounded-xl p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">CPU Usage</p>
                            <p class="text-xl font-bold" id="cpu-usage">0%</p>
                        </div>
                        <div class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="stat-card rounded-xl p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">Memory</p>
                            <p class="text-xl font-bold" id="memory-usage">0 MB</p>
                        </div>
                        <div class="w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="stat-card rounded-xl p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">Disk Usage</p>
                            <p class="text-xl font-bold" id="disk-usage">0 GB</p>
                        </div>
                        <div class="w-8 h-8 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="stat-card rounded-xl p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">Network ↓</p>
                            <p class="text-xl font-bold" id="network-rx">0 MB</p>
                        </div>
                        <div class="w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="stat-card rounded-xl p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">Network ↑</p>
                            <p class="text-xl font-bold" id="network-tx">0 MB</p>
                        </div>
                        <div class="w-8 h-8 bg-pink-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-pink-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="stat-card rounded-xl p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">Players</p>
                            <p class="text-xl font-bold" id="player-count">0 / 20</p>
                        </div>
                        <div class="w-8 h-8 bg-indigo-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-indigo-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Console and Charts -->
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                <!-- Console Terminal -->
                <div class="xl:col-span-2">
                    <div class="glass-card rounded-xl overflow-hidden">
                        <div class="bg-slate-800/50 px-4 py-3 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="font-semibold">Server Console</h3>
                                <div class="flex items-center space-x-2">
                                    <button class="text-gray-400 hover:text-white p-1 rounded" onclick="clearConsole()" title="Clear Console">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"/>
                                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                                        </svg>
                                    </button>
                                    <div class="flex items-center space-x-1 text-sm text-gray-400">
                                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                        <span>Connected</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="terminal-wrapper p-4">
                            <div id="terminal" class="h-96"></div>
                        </div>

                        <div class="bg-slate-800/50 px-4 py-3 border-t border-gray-700">
                            <div class="flex items-center space-x-3">
                                <span class="text-sm text-gray-400">$</span>
                                <input 
                                    type="text" 
                                    id="console-input" 
                                    class="console-input flex-1 px-3 py-2 rounded-lg text-sm focus:outline-none" 
                                    placeholder="Enter command..."
                                    onkeypress="handleConsoleInput(event)"
                                >
                                <button 
                                    class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-medium"
                                    onclick="sendCommand()"
                                >
                                    Send
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Charts -->
                <div class="space-y-6">
                    <div class="glass-card rounded-xl p-4">
                        <h4 class="font-semibold mb-3">CPU Usage</h4>
                        <div class="chart-container">
                            <canvas id="cpu-chart"></canvas>
                        </div>
                    </div>

                    <div class="glass-card rounded-xl p-4">
                        <h4 class="font-semibold mb-3">Memory Usage</h4>
                        <div class="chart-container">
                            <canvas id="memory-chart"></canvas>
                        </div>
                    </div>

                    <div class="glass-card rounded-xl p-4">
                        <h4 class="font-semibold mb-3">Network Activity</h4>
                        <div class="chart-container">
                            <canvas id="network-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Terminal setup
        const terminal = new Terminal({
            theme: {
                background: '#0f172a',
                foreground: '#e2e8f0',
                cursor: '#3b82f6',
                selection: 'rgba(59, 130, 246, 0.3)'
            },
            fontSize: 14,
            fontFamily: 'Menlo, Monaco, "Courier New", monospace',
            cursorBlink: true,
            scrollback: 1000
        });

        const fitAddon = new FitAddon.FitAddon();
        terminal.loadAddon(fitAddon);
        terminal.open(document.getElementById('terminal'));
        fitAddon.fit();

        // Command history
        let commandHistory = [];
        let historyIndex = -1;

        // WebSocket connection for real-time console
        let ws = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;

        function connectWebSocket() {
            try {
                ws = new WebSocket('ws://localhost:3001/ws');
                
                ws.onopen = function() {
                    console.log('WebSocket connected');
                    reconnectAttempts = 0;
                    terminal.writeln('\x1b[32m[INFO] Connected to server console\x1b[0m');
                };

                ws.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'console') {
                        terminal.writeln(data.message);
                    } else if (data.type === 'stats') {
                        updateStats(data.data);
                    }
                };

                ws.onclose = function() {
                    console.log('WebSocket disconnected');
                    terminal.writeln('\x1b[31m[ERROR] Disconnected from server console\x1b[0m');
                    
                    if (reconnectAttempts < maxReconnectAttempts) {
                        reconnectAttempts++;
                        setTimeout(connectWebSocket, 3000);
                    }
                };

                ws.onerror = function(error) {
                    console.error('WebSocket error:', error);
                    terminal.writeln('\x1b[31m[ERROR] Connection failed\x1b[0m');
                };
            } catch (error) {
                console.error('Failed to create WebSocket:', error);
                // Fall back to simulated data for demo
                simulateServerData();
            }
        }

        // Simulate server data for demo purposes
        function simulateServerData() {
            terminal.writeln('\x1b[33m[DEMO] Using simulated data (WebSocket unavailable)\x1b[0m');
            terminal.writeln('[Server thread/INFO]: Starting minecraft server version 1.20.1');
            terminal.writeln('[Server thread/INFO]: Loading properties');
            terminal.writeln('[Server thread/INFO]: Default game type: SURVIVAL');
            terminal.writeln('[Server thread/INFO]: Generating keypair');
            terminal.writeln('[Server thread/INFO]: Starting Minecraft server on *:25565');
            terminal.writeln('[Server thread/INFO]: Done (4.123s)! For help, type "help"');
            
            // Simulate periodic stats updates
            setInterval(() => {
                const stats = {
                    cpu: Math.random() * 100,
                    memory: Math.random() * 2048,
                    disk: Math.random() * 10000,
                    networkRx: Math.random() * 1000,
                    networkTx: Math.random() * 500,
                    players: Math.floor(Math.random() * 20)
                };
                updateStats(stats);
            }, 2000);
        }

        // Initialize charts
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    display: false
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)'
                    }
                }
            }
        };

        const cpuChart = new Chart(document.getElementById('cpu-chart'), {
            type: 'line',
            data: {
                labels: Array(30).fill(''),
                datasets: [{
                    data: Array(30).fill(0),
                    borderColor: 'rgb(59, 130, 246)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: chartOptions
        });

        const memoryChart = new Chart(document.getElementById('memory-chart'), {
            type: 'line',
            data: {
                labels: Array(30).fill(''),
                datasets: [{
                    data: Array(30).fill(0),
                    borderColor: 'rgb(34, 197, 94)',
                    backgroundColor: 'rgba(34, 197, 94, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: chartOptions
        });

        const networkChart = new Chart(document.getElementById('network-chart'), {
            type: 'line',
            data: {
                labels: Array(30).fill(''),
                datasets: [{
                    label: 'Download',
                    data: Array(30).fill(0),
                    borderColor: 'rgb(168, 85, 247)',
                    backgroundColor: 'rgba(168, 85, 247, 0.1)',
                    fill: true,
                    tension: 0.4
                }, {
                    label: 'Upload',
                    data: Array(30).fill(0),
                    borderColor: 'rgb(236, 72, 153)',
                    backgroundColor: 'rgba(236, 72, 153, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                ...chartOptions,
                plugins: {
                    legend: {
                        display: true,
                        labels: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });

        // Update stats function
        function updateStats(stats) {
            document.getElementById('cpu-usage').textContent = `${stats.cpu.toFixed(1)}%`;
            document.getElementById('memory-usage').textContent = `${(stats.memory / 1024).toFixed(1)} GB`;
            document.getElementById('disk-usage').textContent = `${(stats.disk / 1024).toFixed(1)} GB`;
            document.getElementById('network-rx').textContent = `${(stats.networkRx / 1024).toFixed(1)} GB`;
            document.getElementById('network-tx').textContent = `${(stats.networkTx / 1024).toFixed(1)} GB`;
            document.getElementById('player-count').textContent = `${stats.players} / 20`;

            // Update charts
            updateChart(cpuChart, stats.cpu);
            updateChart(memoryChart, stats.memory);
            updateChart(networkChart, stats.networkRx, 0);
            updateChart(networkChart, stats.networkTx, 1);
        }

        function updateChart(chart, value, datasetIndex = 0) {
            chart.data.datasets[datasetIndex].data.shift();
            chart.data.datasets[datasetIndex].data.push(value);
            chart.update('none');
        }

        // Console input handling
        function handleConsoleInput(event) {
            if (event.key === 'Enter') {
                sendCommand();
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    document.getElementById('console-input').value = commandHistory[historyIndex] || '';
                }
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (historyIndex > -1) {
                    historyIndex--;
                    document.getElementById('console-input').value = commandHistory[historyIndex] || '';
                }
            }
        }

        function sendCommand() {
            const input = document.getElementById('console-input');
            const command = input.value.trim();
            
            if (command) {
                commandHistory.unshift(command);
                historyIndex = -1;
                
                terminal.writeln(`\x1b[36m> ${command}\x1b[0m`);
                
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        type: 'command',
                        command: command
                    }));
                } else {
                    // Simulate command response for demo
                    setTimeout(() => {
                        terminal.writeln(`[Server thread/INFO]: Unknown command. Type "/help" for help.`);
                    }, 100);
                }
                
                input.value = '';
            }
        }

        function clearConsole() {
            terminal.clear();
        }

        // Power actions
        function sendPowerAction(action) {
            terminal.writeln(`\x1b[33m[SYSTEM] Sending ${action} signal...\x1b[0m`);
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'power',
                    action: action
                }));
            } else {
                // Simulate power action response for demo
                setTimeout(() => {
                    terminal.writeln(`\x1b[32m[SYSTEM] ${action.toUpperCase()} signal sent successfully\x1b[0m`);
                }, 500);
            }
        }

        // Window resize handler
        window.addEventListener('resize', () => {
            fitAddon.fit();
        });

        // Initialize connection
        connectWebSocket();
    </script>
</body>
</html>
